# fif-payments-bff-login-commercial

BFF para el login-commercial de usuarios merchant de Wallet

## Installation of dependencies

```sh
npm install
```

### Context environment

The context has the general information about the system,  general configuration and  the order of the middlewares which will be called at the begging.

These file have to be created at

```sh
/context/definitions/
```

The dafault is **default.js**. The name of the file is handled by the ENV called **NODE_ENV_CONTEXT**

```sh
NODE_ENV_CONTEXT=default
```

### Environments

Normally exists 4. local, test, qa and production. These are set by the ENV called **NODE_ENV**

```sh
NODE_ENV=local
```

The specfic configurations are in **app/config**.

## To run  local

To run the service locally, the following  command has to be run

```sh
npm run  local-default
```

If you want to run in mode **watch** (reload the service for each change)

```sh
npm run  local-default-w
```

## To run local with stub services

Builds de service and run it with stub service dependences.

```sh
docker-compose up
```

To retrieve last version of stubs:

```sh
docker-compose pull
```

To rebuild image before running

```sh
docker-compose up --build
```



## Unit testing

to run the tests

```sh
npm run unit-test
```

to run the tests with **watch**

```sh
npm run unit-test-w
```

## Coverage

To see the current coverage

```sh
npm run coverage
```

To see more details on the console

```sh
npm run coverage-table
```

To get and html report inside your project and see more details about the coverage

```sh
npm run coverage-html
```

To see if the all type of coverages are ok (over 80%)

```sh
npm run coverage-check
```

## Linter

To run eslint

```sh
npm run eslint
```

To run eslint with **watch**

```sh
npm run eslint-w
```

if you want eslint to fix some errores (**not** all the errors can be fixed)

```sh
npm run eslint-fix
```

## lcov file

The **lcov** can be generated by the command

```sh
npm run lcov
```

the lcov file will be moved to the root in order to be read  by Sonar(the pipeline has to have a stage to do this)

## Mutation testing

To run the mutation testing

```sh
npm run mutation-test
```

**Note**  All the unit tests have to run without any problems.

This command will take a while. The **thresholds** is configured at **stryker.conf.js** (the coverage has to be over 60%)

## Nodemon Debug in VsCode

Paste this json in file "launch.json" behind folder ".vscode" in root project:

```
{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "node",
            "request": "attach",
            "name": "Node: Nodemon",
            "processId": "${command:PickProcess}",
            "restart": true,
            "protocol": "inspector",
        },
    ]
}
```

Run in console next script: npm run local-default-w-debug
Press F5 in vscode to attach to nodemon
